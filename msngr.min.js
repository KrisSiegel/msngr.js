var msngr=msngr||function(){"use strict";var e={},t=function(){var e=Array.prototype.slice.call(arguments,0);return t.message.apply(this,e)};return t.version="5.2.1",t.extend=function(r){if(void 0!==r&&null!==r&&"[object Function]"===Object.prototype.toString.call(r))return r.apply(this,[t,e])},Object.defineProperty(t,"debug",{set:function(r){!0===r?t.internal=e:!1===r&&delete t.internal},get:function(){return void 0!==t.internal}}),t}();msngr.extend(function(e,t){"use strict";t.InvalidParametersException=function(t,r){var n={name:"InvalidParametersException",severity:"unrecoverable",message:"Invalid parameters supplied to the {method} method".replace("{method}",t)};return e.is(r).empty||(n.message=n.message+" "+r),n},t.DuplicateException=function(e){return{name:"DuplicateException",severity:"unrecoverable",message:"Duplicate input provided to {method} where duplicates are not allowed.".replace("{method}",e)}},t.ReservedKeywordsException=function(e){return{name:"ReservedKeywordsException",severity:"unrecoverable",message:"Reserved keyword {keyword} supplied as action.".replace("{keyword}",e)}},t.MangledException=function(e,t){return{name:"MangledException",severity:"unrecoverable",message:"The {variable} was unexpectedly mangled in {method}.".replace("{variable}",e).replace("{method}",t)}}}),msngr.extend(function(e,t){"use strict";var r={arguments:"[object Arguments]",boolean:"[object Boolean]",string:"[object String]",date:"[object Date]",array:"[object Array]",number:"[object Number]",object:"[object Object]",function:"[object Function]",undefined:"[object Undefined]",null:"[object Null]",symbol:"[object Symbol]",nodeList:"[object NodeList]"},n=function(e){return Object.prototype.toString.call(e)},o={htmlElement:function(e){return 0===e.indexOf("[object HTML")||0===e.indexOf("[object global]")},promise:function(e,t){return"[object Promise]"===e||(e===r.object||e===r.function)&&(void 0!==item.then&&n(item.then)===r.function)}},i=function(e,t,i){return i?o[e](n(t),t):n(t)===r[e]},a=function(e,t){switch(e){case r.undefined:case r.null:return!0;case r.string:return 0===t.trim().length;case r.object:return 0===Object.keys(t).length;case r.array:return 0===t.length;default:return!1}},c=function(e){var t={},c=function(r,n){for(var o in r)r.hasOwnProperty(o)&&function(r){Object.defineProperty(t,r,{get:function(){for(var t=0;t<e.length;++t)if(!i(r,e[t],n))return!1;return!0}})}(o)};return c(r,!1),c(o,!0),Object.defineProperty(t,"there",{get:function(){for(var t=0;t<e.length;++t)if(void 0===e[t]||null===e[t])return!1;return!0}}),Object.defineProperty(t,"empty",{get:function(){for(var t=0;t<e.length;++t)if(!a(n(e[t]),e[t]))return!1;return!0}}),t};t.types=r,e.is=function(){var e=Array.prototype.slice.call(arguments,0),t=c(e=e||[void 0]);return t.getType=function(){return Object.prototype.toString.call(e[0])},t.getTypes=function(){for(var t=[],r=0;r<e.length;++r)t.push(Object.prototype.toString.call(e[r]));return t},t},e.is.browser="undefined"!=typeof XMLHttpRequest}),msngr.extend(function(e,t){"use strict";e.deDupeArray=function(e){for(var t={},r=[],n=e.length,o=0;o<n;++o)void 0===t[e[o]]&&(t[e[o]]=!0,r.push(e[o]));return r}}),msngr.extend(function(e,t){"use strict";var r=0,n="Mxxx".replace(/[x]/g,function(){return Math.floor(100*Math.random())});e.id=function(){return++r,n+r},e.uuid=function(){var t=e.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var r=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?r:3&r|8).toString(16)})}}),msngr.extend(function(e,t){"use strict";var r;if("undefined"!=typeof window&&void 0!==window.postMessage){var n=[];window.addEventListener("message",function(e){e.source===window&&"__msngr_immediate"===e.data&&(e.stopPropagation(),n.length>0&&n.shift()())},!0)}e.immediate=function(e){void 0===r&&(r="undefined"!=typeof setImmediate?setImmediate:"undefined"!=typeof window&&void 0!==window.postMessage?function(e){n.push(e),window.postMessage("__msngr_immediate","*")}:function(e){setTimeout(e,0)}),r(e)}}),msngr.extend(function(e,t){"use strict";var r=void 0,n="",o=void 0,i=function(){return performance.now()},a=function(){return process.hrtime()[1]/1e6},c=function(){return Date.now()};e.now=function(t){void 0===r&&("undefined"!=typeof performance?(r=i,n="performance"):"undefined"!=typeof process?(r=a,n="node"):(r=c,n="legacy"));var u=r();return!0===t&&o===u?e.now(t):(o=u,u)}}),msngr.extend(function(e,t){"use strict";e.asyncify=function(t){return e.is(t).function&&(t.async=function(){var r=[].slice.call(arguments),n=r.pop();e.is(n).function&&function(r,n){e.immediate(function(){try{n.apply(null,[null,t.apply(null,r)])}catch(e){n.apply(null,[e,null])}})}(r,n)}),t}}),msngr.extend(function(e,t){"use strict";var r={};r[t.types.string]=function(e){return e},r[t.types.number]=function(e){return e},r[t.types.boolean]=function(e){return e},r[t.types.date]=function(e){var t=new Date;return t.setTime(e.getTime()),t},r[t.types.object]=function(t){var r={};for(var n in t)t.hasOwnProperty(n)&&(r[n]=e.copy(t[n]));return r},r[t.types.array]=function(t){for(var r=[],n=0;n<t.length;n++)r[n]=e.copy(t[n]);return r},r[t.types.function]=function(t){var r=t.bind({});for(var n in t)t.hasOwnProperty(n)&&(r[n]=e.copy(t[n]));return r},e.copy=function(t){if(void 0===t||null===t)return t;var n=e.is(t).getType();return void 0!==r[n]?r[n](t):t}}),msngr.extend(function(e,t){"use strict";var r=[t.types.object,t.types.function,t.types.array],n=[t.types.object,t.types.array],o=function(i,a,c){if(void 0===i||null===i)return a;if(void 0===a||null===a)return i;var u=e.is(i).getType(),s=e.is(a).getType(),p=void 0;if(-1!==r.indexOf(u)&&-1!==n.indexOf(s)||(p=t.InvalidParametersException("msngr.merge()","Only objects, arrays or a single function followed by objects can be merged!")),-1===[u,s].indexOf(t.types.array)||u===t.types.array&&s===t.types.array||(p=t.InvalidParametersException("msngr.merge()","Arrays cannot be merged with objects or functions!")),void 0!==p){if(!0===c)return a;throw p}var f=i;if(u===t.types.array&&s===t.types.array)return i.concat(a);for(var d in a)if(a.hasOwnProperty(d)){var l=e.is(a[d]);l.object?(f[d]=f[d]||{},f[d]=o(f[d],a[d])):l.array?(f[d]=f[d]||[],f[d]=f[d].concat(a[d])):f[d]=a[d]}return f};t.merge=function(){var e=Array.prototype.slice.call(arguments,0);if(e.length<=1)return e[0];for(var t=e.shift();e.length>0;)t=o(t,e.shift(),!0);return t},e.merge=function(){var e=Array.prototype.slice.call(arguments,0);if(e.length<=1)return e[0];for(var t=e.shift();e.length>0;)t=o(t,e.shift());return t}}),msngr.extend(function(e,t){"use strict";e.safe=function(r,n,o){if(!e.is(r).object||!e.is(n).string)throw t.InvalidParametersException("msngr.safe");for(var i=n.split("."),a=r,c=void 0;(c=i.shift())&&void 0!==(a=a[c]););return e.is(a).there?a:o}}),msngr.extend(function(e,t){"use strict";t.executer=function(t){for(var r=0;r<t.length;++r)e.is(t[r]).function&&(t[r]={method:t[r]});var n=function(t,r,n,o){var i=e.is(r);e.immediate(function(){var e=!1,a=function(){return e=!0,function(e){o.apply(n,[e])}};i.array||(r=i.there?[r]:[]),r.push(a);var c=t.apply(n||void 0,r);!0!==e&&o.apply(n,[c])})};return{parallel:function(r){var o=e.is(r),i=[],a=0;if(0===t.length&&o.there)return r.apply(null,[[]]);for(var c=0;c<t.length;++c)!function(c,u,s){n(c,u,s,function(n){e.is(n).there&&i.push(n),++a===t.length&&o.there&&r.apply(s||null,[i])})}(t[c].method,t[c].params,t[c].context)},series:function(r){var o=e.is(r),i=[];if(0===t.length&&o.there)return r.apply(null,[[]]);var a=function(){var c=t.shift();!function(c,u,s){n(c,u,s,function(n){e.is(n).there&&i.push(n),0===t.length&&o.there?r.apply(s||null,[i]):a()})}(c.method,c.params,c.context)};a()}}},e.parallel=function(e,r){t.executer(e).parallel.apply(this,[r])},e.series=function(e,r){t.executer(e).series.apply(this,[r])}}),msngr.extend(function(e,t){"use strict";var r=function(e){return void 0!==e&&null!==e},n=function(e,t){var r=e.indexOf(t),n=e.length-1;if(r!==n){var o=e[n];e[n]=e[r],e[r]=o}e.pop()};t.memory=function(){var t={},o={},i=0,a={index:function(n){if(r(n)&&r(n.topic)){var a=e.id();return t[a]=e.copy(n),r(o[n.topic])||(o[n.topic]={ids:[],category:{}}),r(o[n.topic].category[n.category])||(o[n.topic].category[n.category]={ids:[],subcategory:{}}),r(o[n.topic].category[n.category].subcategory[n.subcategory])||(o[n.topic].category[n.category].subcategory[n.subcategory]={ids:[]}),r(n.category)||r(n.subcategory)||o[n.topic].ids.push(a),r(n.category)&&!r(n.subcategory)&&o[n.topic].category[n.category].ids.push(a),r(n.category)&&r(n.subcategory)&&o[n.topic].category[n.category].subcategory[n.subcategory].ids.push(a),i++,a}},getById:function(e){return t[e]},delete:function(e){if(r(e)&&r(t[e])){var a=t[e];return n(o[a.topic].ids,e),n(o[a.topic].category[a.category].ids,e),n(o[a.topic].category[a.category].subcategory[a.subcategory].ids,e),delete t[e],i--,!0}return!1},query:function(t){var n=[];if(r(t)&&r(t.topic)&&r(o[t.topic])){var i=o[t.topic],a=((i||{}).category||{})[t.category],c=((a||{}).subcategory||{})[t.subcategory];n=(n=(n=n.concat(i.ids||[])).concat((a||{}).ids||[])).concat((c||{}).ids||[])}return e.deDupeArray(n)},clear:function(){return t={},o={},i=0,!0}};return Object.defineProperty(a,"count",{get:function(){return i}}),a}}),msngr.extend(function(e,t){"use strict";var r=t.memory(),n=t.memory(),o={},i=0,a={},c=0,u={},s=[];Object.defineProperty(t,"handlerCount",{get:function(){return i}}),Object.defineProperty(t,"payloadCount",{get:function(){return c}}),t.reset=function(){o={},i=0,r.clear(),n.clear(),a={},c=0,u={},s=[]};var p=function(t){var r=n.query(t);if(0!==r.length){var o=a[r[0]];if(r.length>1)for(var i=1;i<r.length;++i)o=e.merge(innerPay,fpay);return o}},f=function(e,t,r){for(var n=[],o=e||[],i=0;i<s.length;++i)-1===o.indexOf(s[i])&&o.push(s[i]);for(i=0;i<o.length;++i)void 0!==u[o[i]]&&n.push({method:u[o[i]],params:[t,r]});return n};t.getMiddlewares=f;var d=function(e,r,n,o){var i=f(e,r,n);t.executer(i).series(function(e){return o(t.merge.apply(this,[r].concat(e)))})},l=function(e,t,r,n){d(e,t,r,function(e){n.apply(void 0,[e])})},y=function(n,i,a){var c=e.is(n).array?n:r.query(n);if(c.length>0){for(var u=[],s=[],p=0;p<c.length;++p){var f=e.is(n).object?e.copy(n):e.copy(r.query(c[p])),d=o[c[p]];u.push({method:d.handler,params:[i,f]}),!0===d.once&&s.push({msg:f,handler:d.handler})}for(var l=t.executer(u),p=0;p<s.length;++p)e(s[p].msg).drop(s[p].handler);l.parallel(a)}};e.message=function(u,f,d){var g=e.is(u),h=e.is(f),v=e.is(d);if(!g.there)throw t.InvalidParametersException("msngr()");if(!g.object&&!g.string)throw t.InvalidParametersException("msngr()");if(g.empty)throw t.InvalidParametersException("msngr()");var m;g.object?m=e.copy(u):((m={}).topic=u,!h.empty&&h.string&&(m.category=f),!v.empty&&v.string&&(m.subcategory=d));for(var b in m)m.hasOwnProperty(b)&&(m[b]=m[b].toLowerCase());var x=[],w={use:function(t){if(!e.is(t).empty){var r=t.toLowerCase();-1===x.indexOf(r)&&x.push(t.toLowerCase())}return w},emit:function(t,r){return e.is(t).function&&(r=t,t=void 0),x.length>0||s.length>0?l(x,t,m,function(e){y(m,e,r)}):y(m,t,r),w},persist:function(t){void 0===t&&(t=null);var r=n.query(m);if(0===r.length){var o=n.index(m);a[o]=t,r=[o]}else for(var i=0;i<r.length;++i)a[r[i]]=e.merge(t,a[r[i]]);return++c,w.emit(p(m))},cease:function(){for(var e=n.query(m),t=0;t<e.length;++t)delete a[e[t]],--c;return w},on:function(e){var t=r.index(m);o[t]={handler:e,context:m.context||this,once:!1},i++;var n=p(m);return void 0!==n&&(x.length>0||s.length>0?l(x,n,m,function(e){y([t],e,void 0)}):y([t],n,void 0)),w},once:function(e){var t=r.index(m);o[t]={handler:e,context:m.context||this,once:!0},i++;var n=p(m);return void 0!==n&&(x.length>0||s.length>0?l(x,n,m,function(e){y([t],e,void 0)}):y([t],n,void 0)),w},drop:function(e){var t=r.query(m);if(t.length>0)for(var n=0;n<t.length;++n){var a=t[n];o[a].handler===e&&(delete o[a],i--,r.delete(a))}return w},dropAll:function(){var e=r.query(m);if(e.length>0)for(var t=0;t<e.length;++t){var n=e[t];delete o[n],i--,r.delete(n)}return w}};return Object.defineProperty(w,"message",{get:function(){return m}}),Object.defineProperty(w,"topic",{get:function(){return m.topic}}),Object.defineProperty(w,"category",{get:function(){return m.category}}),Object.defineProperty(w,"subcategory",{get:function(){return m.subcategory}}),Object.defineProperty(w,"handlers",{get:function(){return r.query(m).length}}),w},e.middleware=function(r,n,o){var i=e.is(r),a=e.is(n);if(!i.there||!i.string||i.empty||!a.there||!a.function)throw t.InvalidParametersException("msngr.middleware()");if(e.is(u[r]).there)throw t.DuplicateException("msngr.middleware()");var c=r.toLowerCase();u[c]=n,!0===o&&s.push(c)},e.unmiddleware=function(r){var n=e.is(r);if(!n.there||!n.string||n.empty)throw t.InvalidParametersException("msngr.unmiddleware()");var o=r.toLowerCase(),i=s.indexOf(o);-1!==i&&s.splice(i,1),void 0!==u[o]&&delete u[o]}}),msngr.extend(function(e,t){"use strict";e.mache=function(r){var n={events:{onChange:{topic:"msngr.mache",category:"change",emit:(r=r||{}).emitChanges||!1}},revisions:{toKeep:r.revisions||3}},o={},i={},a=void 0,c=void 0,u=!1,s=function(e){if(void 0!==i[e])return i[e][i[e].length-1]},p=function(e){return!0===c[e]?void 0:a[e]||s(e)},f=function(r,a){return void 0===i[r]&&(i[r]=[]),i[r].push(t.merge(e.copy(h.get(r)),e.copy(a))),o[r]=h.get(r),i[r].length>n.revisions.toKeep&&i[r].shift(),n.events.onChange.emit&&e.message(n.events.onChange.topic,n.events.onChange.category,r).emit({id:r,oldValue:i[r][i[r].length-2],newValue:i[r][i[r].length-1]}),!0},d=function(r,n){return a[r]=t.merge(a[r]||s(r),e.copy(n)),!0},l=function(e){return void 0!==i[e]&&(delete i[e],delete o[e],!0)},y=function(e){return(void 0!==a[e]||void 0!==i[e])&&(void 0!==a[e]&&delete a[e],c[e]=!0,!0)},g=function(e){return void 0!==i[e]&&(1===i[e].length?(delete i[e],delete o[e],!0):(i[e].pop(),o[e]=h.get(e),!0))},h={get:function(e){return u?p(e):s(e)},getDeep:function(t,r,n){var o=h.get(t);if(void 0===o||e.is(r).empty)return n;for(var i=r.trim().split("."),a=o,c=0;c<i.length;++c){if(void 0===a[i[c]])return n;a=a[i[c]]}return e.is(a).there?a:n},set:function(e,t){return u?d(e,t):f(e,t)},remove:function(e){return u?y(e):l(e)},revert:function(e){return!u&&g(e)},begin:function(){return!u&&(u=!0,a={},c={},!0)},rollback:function(){return!!u&&(u=!1,a=void 0,c=void 0,!0)},commit:function(){if(!u)return!1;u=!1;for(var e in a)a.hasOwnProperty(e)&&f(e,a[e]);for(var e in c)c.hasOwnProperty(e)&&l(e);return a=void 0,c=void 0,!0}};return Object.defineProperty(h,"meta",{configurable:!1,enumerable:!1,get:function(){return n}}),Object.defineProperty(h,"data",{configurable:!1,enumerable:!1,get:function(){return u?t.merge(e.copy(o),a):o}}),Object.defineProperty(h,"count",{configurable:!1,enumerable:!1,get:function(){return Object.keys(h.data).length}}),h},e.config=e.mache()}),msngr.extend(function(e,t){"use strict";t.net=t.net||{},t.net.browser=function(t,r,n){try{var o=new XMLHttpRequest;o.onreadystatechange=function(){if(4===o.readyState)if(200===o.status||201===o.status){var t;if(!0===r.autoJson&&"application/json"===(this.getResponseHeader("content-type")||"").toLowerCase())try{t=JSON.parse(o.response)}catch(e){t=void 0}e.is(n).there&&n.apply(void 0,[null,t||o.response])}else{var i={status:o.status,response:o.response};e.is(n).there&&n.apply(void 0,[i,null])}};var i=t.protocol+"://"+t.host;!0===t.canOmitPort?i+=r.path:i=i+":"+t.port+r.path;var a;if(e.is(r.payload).there){if(e.is(r.payload).object)try{a=JSON.stringify(r.payload)}catch(e){}void 0===a&&(a=r.payload)}if(o.open(r.method,i,!0),e.is(r.headers).there)for(var c in r.headers)r.headers.hasOwnProperty(c)&&o.setRequestHeader(c,r.headers[c]);o.send(a)}catch(t){e.is(n).there&&n.apply(void 0,[t,null])}}}),msngr.extend(function(e,t){"use strict";t.net=t.net||{};var r={path:"/",protocol:"http",port:{http:"80",https:"443"},autoJson:!0},n=function(r,n,o){if(e.is(n.query).there&&(e.is(n.query).string&&(n.queryString=n.query),e.is(n.query).object)){n.queryString="?";for(var i in n.query)n.query.hasOwnProperty(i)&&("?"!==n.queryString&&(n.queryString=n.queryString+"&"),n.queryString=n.queryString+encodeURIComponent(i)+"="+encodeURIComponent(n.query[i]))}n.path=n.path+(n.queryString||""),e.is.browser?t.net.browser(r,n,o):t.net.node(r,n,o)},o=function(n,o,i){var a,c={protocol:void 0,host:void 0,port:void 0,canOmitPort:!1},u=!1,s=!1;if(e.is(n).empty&&(s=!0,a="Protocol or host not provided"),!s&&!e.is(n).empty&&e.is(o).empty&&e.is(i).empty){var p=n.split("://");2==p.length?(c.protocol=p[0],c.host=p[1]):(c.host=n,c.protocol=r.protocol),-1!==(f=c.host.lastIndexOf(":"))?(c.port=c.host.substring(f+1,c.host.length),c.host=c.host.substring(0,f)):c.port=r.port[c.protocol],u=!0}if(!s&&!u&&!e.is(n).empty&&!e.is(o).empty&&e.is(i).empty){c.protocol=n,c.host=o;var f=c.host.lastIndexOf(":");-1!==f?(c.port=c.host.substring(f+1,c.host.length),c.host=c.host.substring(0,f)):c.port=r.port[c.protocol],u=!0}if(s||u||e.is(n).empty||e.is(o).empty||e.is(i).empty||(c.protocol=n,c.host=o,c.port=i,u=!0),!s&&u&&r.port[c.protocol]===c.port&&(c.canOmitPort=!0),s||u||(s=!0,a="Unable to handle input into method. Please open a GitHub issue with your input :)"),!0===s)throw t.InvalidParametersException("net",a);var d=function(e){var t=e.indexOf("/");return e.substring(0,-1===t?e.length:t)};return c.host=d(c.host),c.port=d(c.port),c};e.net=function(i,a,c){var u=o(i,a,c),s={get:function(o,i){var a=t.merge(e.copy(r),o);a.method="get",n(u,a,i)},post:function(o,i){var a=t.merge(e.copy(r),o);a.method="post",n(u,a,i)},put:function(o,i){var a=t.merge(e.copy(r),o);a.method="put",n(u,a,i)},delete:function(o,i){var a=t.merge(e.copy(r),o);a.method="delete",n(u,a,i)},options:function(o,i){var a=t.merge(e.copy(r),o);a.method="options",n(u,a,i)}};return Object.defineProperty(s,"protocol",{get:function(){return u.protocol}}),Object.defineProperty(s,"host",{get:function(){return u.host}}),Object.defineProperty(s,"port",{get:function(){return u.port}}),s}}),msngr.extend(function(e,t){"use strict";t.net=t.net||{},t.net.node=function(t,r,n){var o=require("http").request({method:r.method,host:t.host,port:t.port,path:r.path,headers:r.headers},function(t){t.setEncoding("utf8");var i="";t.on("data",function(e){i+=e}),t.on("end",function(){var a;if(!0===r.autoJson&&"application/json"===(t.headers["content-type"]||"").toLowerCase())try{a=JSON.parse(i)}catch(e){a=void 0}a=a||i;var c;o.statusCode>=400&&(c={status:o.statusCode,response:a||i},a=null),e.is(n).there&&n.apply(void 0,[c,a])})});if(e.is(r.payload).there){var i;if(e.is(r.payload).object)try{i=JSON.stringify(r.payload)}catch(e){}void 0===i&&(i=r.payload),o.write(i)}o.end()}}),"undefined"!=typeof module&&void 0!==module.exports&&(module.exports=msngr);