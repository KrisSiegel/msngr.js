var msngr=msngr||function(){return{extend:function(obj,target){if(target=target||msngr,"[object Object]"===Object.prototype.toString.call(obj))for(var key in obj)obj.hasOwnProperty(key)&&("[object Object]"===Object.prototype.toString.call(obj[key])?(void 0===target[key]&&(target[key]={}),target[key]=msngr.extend(obj[key],target[key])):target[key]="[object Array]"===Object.prototype.toString.call(obj[key])?(target[key]||[]).concat(obj[key]):obj[key]);return target}}}();msngr.extend(function(){return{utils:{argumentsToArray:function(args){return Array.prototype.slice.call(args,0)}}}}()),msngr.extend(function(){return{utils:{ensureMessage:function(message){return msngr.utils.isNullOrUndefined(message)?void 0:msngr.utils.isString(message)&&!msngr.utils.isEmptyString(message)?{topic:message}:message}}}}()),msngr.extend(function(){return{utils:{ThrowNotImplementedException:function(){throw"Method is not implemented"},ThrowRequiredParameterMissingOrUndefinedException:function(params){throw msngr.utils.isArray(params)?params.join(",")+" are required parameters and must not be missing or undefined":params+" is a required parameter and must not be missing or undefined"},ThrowMismatchedInterfaceException:function(interface){throw"The implementation does not match the "+(interface||"unknown")+" interface"}}}}()),msngr.extend(function(){return{utils:{arrayContains:function(arr,values){if(msngr.utils.isNullOrUndefined(arr))return!1;msngr.utils.isArray(values)||(values=[values]);for(var i=0;i<values.length;++i)if(-1===arr.indexOf(values[i]))return!1;return!0}}}}()),msngr.extend(function(){return{utils:{getType:function(obj){return Object.prototype.toString.call(obj)},isNullOrUndefined:function(obj){return void 0===obj||null===obj},isString:function(str){return"[object String]"===this.getType(str)},isDate:function(obj){return"[object Date]"===this.getType(obj)},isArray:function(obj){return"[object Array]"===this.getType(obj)},isNumber:function(obj){return"[object Number]"===this.getType(obj)},isObject:function(obj){return"[object Object]"===this.getType(obj)},isFunction:function(func){return"[object Function]"===this.getType(func)},isEmptyString:function(str){var isStr=this.isString(str);return void 0===str||null===str||isStr&&0===str.toString().length?!0:!1},isWildCardStringMatch:function(str1,str2){if(!this.isNullOrUndefined(str1)&&!this.isString(str1))return!1;if(!this.isNullOrUndefined(str2)&&!this.isString(str2))return!1;var str1EmptyResult,str2EmptyResult,str1Star=-1,str2Star=-1,shorterIndex=-1;return str1EmptyResult=this.isEmptyString(str1),str2EmptyResult=this.isEmptyString(str2),str1EmptyResult===!0||str2EmptyResult===!0?!0:str1.toLowerCase()===str2.toLowerCase()?!0:(str1Star=str1.indexOf("*"),str2Star=str2.indexOf("*"),shorterIndex=shorterIndex=shorterIndex=-1===str1Star||-1===str2Star?Math.max(str1Star,str2Star):Math.min(str1Star,str2Star),-1===str1Star&&-1===str2Star||-1===shorterIndex||str1.substring(0,shorterIndex).toLowerCase()!==str2.substring(0,shorterIndex).toLowerCase()?!1:!0)},isValidMessage:function(message){return this.isNullOrUndefined(message)?!1:this.isString(message)&&!this.isEmptyString(message)?!0:this.isNullOrUndefined(message.topic)||!this.isString(message.topic)||this.isEmptyString(message.topic)?!1:this.isNullOrUndefined(message.category)||this.isString(message.category)?this.isNullOrUndefined(message.dataType)||this.isString(message.dataType)?this.isNullOrUndefined(message.target)||this.isString(message.target)?!0:!1:!1:!1},isMessageMatch:function(sent,target){return this.isWildCardStringMatch(sent.topic,target.topic)&&this.isWildCardStringMatch(sent.category,target.category)&&this.isWildCardStringMatch(sent.dataType,target.dataType)?!0:!1},doesMessageContainWildcard:function(message){return message=this.ensureMessage(message),!this.isValidMessage(message)||-1===(message.topic||"").indexOf("*")&&-1===(message.category||"").indexOf("*")&&-1===(message.dataType||"").indexOf("*")?!1:!0},getPropertiesWithWildcards:function(message){var results=[];return-1!==(message.topic||"").indexOf("*")&&results.push("topic"),-1!==(message.category||"").indexOf("*")&&results.push("category"),-1!==(message.dataType||"").indexOf("*")&&results.push("dataType"),results}}}}()),msngr.extend(function(){return{utils:{verifyInterface:function(object,interface){if(void 0===object&&void 0===interface)return!0;for(var key in interface)if(interface.hasOwnProperty(key)){if(void 0===object)return!1;if(void 0===object[key]||msngr.utils.getType(interface[key])!==msngr.utils.getType(object[key]))return!1;if(msngr.utils.isObject(interface[key])){var result=this.verifyInterface(object[key],interface[key]);if(!result)return result}}return!0}}}}()),msngr.extend(function(){var routers=[];return{registry:{add:function(router){return void 0===router&&msngr.utils.ThrowRequiredParameterMissingOrUndefinedException("router"),msngr.utils.verifyInterface(router,msngr.interfaces.router)?(routers.push(router),this):(msngr.utils.ThrowMismatchedInterfaceException("router"),void 0)},get:function(index){return void 0===index&&msngr.utils.ThrowRequiredParameterMissingOrUndefinedException("index"),routers[index]},count:function(){return routers.length},remove:function(index){void 0===index&&msngr.utils.ThrowRequiredParameterMissingOrUndefinedException("index");var endIndex=routers.length-1;if(index!==endIndex){var temp=routers[endIndex];routers[endIndex]=routers[index],routers[index]=temp}return routers.pop(),this}}}}()),msngr.extend(function(){return{interfaces:{router:{send:function(){msngr.utils.ThrowNotImplementedException()},receive:function(){msngr.utils.ThrowNotImplementedException()}}}}}()),msngr.registry.add(function(){var receivers=[],states={running:"RUNNING",paused:"PAUSED",stopped:"STOPPED"},executeReceiverSync=(states.running,function(method,context,params){method.apply(context,params)}),executeReceiver=function(method,context,params){setTimeout(function(){executeReceiverSync(method,context,params)},0)},handleSend=function(message){msngr.utils.isValidMessage(message)||msngr.utils.ThrowRequiredParameterMissingOrUndefinedException("message");for(var indexesToExecute=[],i=0;i<receivers.length;++i)msngr.utils.isMessageMatch(message,receivers[i].message)&&executeReceiver(receivers[i].callback,receivers[i].context,[message.payload]);indexesToExecute.length>0&&executeReceivers(indexesToExecute)},handleReceiverRegistration=function(message,callback,context){receivers.push({message:message,callback:callback,context:context})};return{send:function(message,callback,context){return msngr.utils.isValidMessage(message)||msngr.utils.ThrowRequiredParameterMissingOrUndefinedException("message"),handleSend(message,callback,context||this),this},receive:function(message,callback,context){return msngr.utils.isValidMessage(message)||msngr.utils.ThrowRequiredParameterMissingOrUndefinedException("message"),handleReceiverRegistration(message,callback,context||this),this}}}()),msngr.extend(function(){return{send:function(message,callback,context){msngr.utils.isValidMessage(message)||msngr.utils.ThrowRequiredParameterMissingOrUndefinedException("message");for(var i=0;i<msngr.registry.count();++i)msngr.registry.get(i).send(msngr.utils.ensureMessage(message),callback,context)}}}()),msngr.extend(function(){return{receive:function(message,callback,context){msngr.utils.isValidMessage(message)||msngr.utils.ThrowRequiredParameterMissingOrUndefinedException("message");for(var i=0;i<msngr.registry.count();++i)msngr.registry.get(i).receive(msngr.utils.ensureMessage(message),callback,context)}}}()),"undefined"!=typeof module&&"undefined"!=typeof module.exports&&(module.exports=msngr);