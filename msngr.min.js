var msngr=msngr||function(){"use strict";var internal={globalOptions:{},warnings:!0},external=function(topic,category,subcategory){return internal.objects.message(topic,category,subcategory)};external.version="2.4.1";var twoMerge=function(input1,input2){if(void 0===input1||null===input1)return input2;if(void 0===input2||null===input2)return input1;var result,type1=Object.prototype.toString.call(input1),type2=Object.prototype.toString.call(input2);if("[object Object]"===type1&&"[object Object]"===type2){result={};for(var key in input1)input1.hasOwnProperty(key)&&(result[key]=input1[key]);for(var key in input2)if(input2.hasOwnProperty(key))if("[object Object]"===Object.prototype.toString.call(input2[key]))void 0===result[key]&&(result[key]={}),result[key]=external.merge(input1[key],input2[key]);else if("[object Array]"===Object.prototype.toString.call(input1[key])&&"[object Array]"===Object.prototype.toString.call(input2[key])){result[key]=input1[key]||[];for(var i=0;i<input2[key].length;++i)-1===result[key].indexOf(input2[key][i])&&result[key].push(input2[key][i])}else result[key]=input2[key];return result}if("[object String]"===type1&&"[object String]"===type2)return result=input1+input2;if("[object Array]"===type1&&"[object Array]"===type2){result=input1;for(var i=0;i<input2.length;++i)-1===result.indexOf(input2[i])&&result.push(input2[i]);return result}if("[object Function]"===type1&&"[object Function]"===type2)return function(i1,i2,args){return function(){return external.merge(i1.apply(this,args),i2.apply(this,args))}}(input1,input2,arguments);var similarObjectTypes=["[object Function]","[object Object]"];if(-1!==similarObjectTypes.indexOf(type1)&&-1!==similarObjectTypes.indexOf(type2)){var method="[object Function]"===type1?input1:input2,props="[object Object]"===type1?input1:input2;if(void 0!==method&&void 0!==props)for(var key in props)props.hasOwnProperty(key)&&(method[key]=props[key]);return result=method}return result};return external.extend=function(obj,target){return target=target||external,"[object Function]"===Object.prototype.toString.call(obj)&&(obj=obj.apply(this,[external,internal])),target=external.merge(obj,target)},external.merge=function(){var result;if(arguments.length>0)for(var i=0;i<arguments.length;++i)result=twoMerge(result,arguments[i]);return result},external.options=function(key,value){if(!external.exist(key))throw internal.InvalidParametersException("key");internal.globalOptions[key]=value},Object.defineProperty(external,"debug",{set:function(value){value===!0?external.internal=internal:value===!1&&delete external.internal},get:function(){return void 0!==external.internal}}),Object.defineProperty(external,"warnings",{set:function(value){internal.warnings=value},get:function(){return internal.warnings}}),external}();msngr.extend(function(external,internal){"use strict";return{argumentsToArray:function(args){return external.isArray(args)?args:external.isArguments(args)?Array.prototype.slice.call(args,0):[args]}}}),msngr.extend(function(external,internal){"use strict";return{isHtmlElement:function(obj){var t=this.getType(obj);return 0===t.indexOf("[object HTML")||0===t.indexOf("[object global]")},isNodeList:function(obj){return"[object NodeList]"===this.getType(obj)},findElement:function(element,root){var elms=external.findElements(element,root);return void 0!==elms&&elms.length>0?elms[0]:elms},findElements:function(selector,root){var elm;if(external.isHtmlElement(selector)&&(elm=selector),void 0===elm&&external.isString(selector)){var doc=root||document,result=doc.querySelectorAll(selector);null!==result&&(elm=result)}return elm},getDomPath:function(element){var node=external.isHtmlElement(element)?element:void 0;return void 0===node?void 0:(void 0===node.id&&(node.id=external.id()),"#"+node.id)},querySelectorAllWithEq:function(selector,root){if(void 0===selector)return null;for(var doc=root||document,queue=[],process=function(input){if(-1===input.indexOf(":eq("))return void 0;var eqlLoc=input.indexOf(":eq("),sel=input.substring(0,eqlLoc),ind=input.substring(eqlLoc+4,input.indexOf(")",eqlLoc));selector=input.substring(input.indexOf(")",eqlLoc)+1,input.length),">"===sel.charAt(0)&&(sel=sel.substring(1,sel.length)),">"===selector.charAt(0)&&(selector=selector.substring(1,selector.length)),queue.push({selector:sel,index:parseInt(ind,10)})};-1!==selector.indexOf(":eq");)process(selector);for(var result;queue.length>0;){var item=queue.shift();result=(result||doc).querySelectorAll(item.selector)[item.index]}return selector.trim().length>0?(result||doc).querySelectorAll(selector):[result]},querySelectorWithEq:function(selector,root){return external.querySelectorAllWithEq(selector,root)[0]}}}),msngr.extend(function(external,internal){"use strict";return internal.InvalidParametersException=function(str){return{name:"InvalidParametersException",severity:"unrecoverable",message:"Invalid parameters supplied to the {method} method".replace("{method}",str)}},internal.ReservedKeywordsException=function(keyword){return{name:"ReservedKeywordsException",severity:"unrecoverable",message:"Reserved keyword {keyword} supplied as action.".replace("{keyword}",keyword)}},internal.MangledException=function(variable,method){return{name:"MangledException",severity:"unrecoverable",message:"The {variable} was unexpectedly mangled in {method}.".replace("{variable}",variable).replace("{method}",method)}},{}}),msngr.extend(function(external,internal){"use strict";var nowPerformance=function(){return performance.now()},nowNode=function(){return process.hrtime()[1]/1e6},nowLegacy=function(){return(new Date).getTime()},nowExec=void 0,nowExecDebugLabel="",lastNow=void 0;return{id:function(){var d=external.now(),uuid="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=(d+16*Math.random())%16|0;return d=Math.floor(d/16),("x"==c?r:3&r|8).toString(16)});return uuid},now:function(noDuplicate){void 0===nowExec&&("undefined"!=typeof performance?(nowExec=nowPerformance,nowExecDebugLabel="performance"):"undefined"!=typeof process?(nowExec=nowNode,nowExecDebugLabel="node"):(nowExec=nowLegacy,nowExecDebugLabel="legacy"));var now=nowExec();return noDuplicate===!0&&lastNow===now?external.now(noDuplicate):(lastNow=now,now)},removeFromArray:function(arr,value){var inx=arr.indexOf(value),endIndex=arr.length-1;if(inx!==endIndex){var temp=arr[endIndex];arr[endIndex]=arr[inx],arr[inx]=temp}arr.pop()},deDupeArray:function(arr){for(var hash={},result=[],arrLength=arr.length,i=0;arrLength>i;++i)void 0===hash[arr[i]]&&(hash[arr[i]]=!0,result.push(arr[i]));return result}}}),msngr.extend(function(external,internal){"use strict";return internal.reiterativeValidation=function(validationMethod,inputs){var result=!1;if(external.exist(validationMethod)&&external.exist(inputs)){external.isArray(inputs)||(inputs=[inputs]);for(var i=0;i<inputs.length&&(result=validationMethod.apply(this,[inputs[i]]),result!==!1);++i);}return result},{getType:function(obj){return external.exist(obj)?Object.prototype.toString.call(obj):""+obj},isArguments:function(obj){return"[object Arguments]"===external.getType(obj)},areArguments:function(){return internal.reiterativeValidation(external.isArguments,external.argumentsToArray(arguments))},isNullOrUndefined:function(obj){return void 0===obj||null===obj},exist:function(obj){return!external.isNullOrUndefined(obj)},exists:function(){return internal.reiterativeValidation(external.exist,external.argumentsToArray(arguments))},isString:function(str){return"[object String]"===external.getType(str)},areStrings:function(){return internal.reiterativeValidation(external.isString,external.argumentsToArray(arguments))},isDate:function(obj){return"[object Date]"===external.getType(obj)},areDates:function(){return internal.reiterativeValidation(external.isDate,external.argumentsToArray(arguments))},isArray:function(obj){return"[object Array]"===external.getType(obj)},areArrays:function(){return internal.reiterativeValidation(external.isArray,external.argumentsToArray(arguments))},isNumber:function(obj){return"[object Number]"===external.getType(obj)},areNumbers:function(){return internal.reiterativeValidation(external.isNumber,external.argumentsToArray(arguments))},isObject:function(obj){return"[object Object]"===external.getType(obj)},areObjects:function(){return internal.reiterativeValidation(external.isObject,external.argumentsToArray(arguments))},isFunction:function(func){return"[object Function]"===external.getType(func)},areFunctions:function(){return internal.reiterativeValidation(external.isFunction,external.argumentsToArray(arguments))},isEmptyString:function(str){var isStr=external.isString(str);return void 0===str||null===str||isStr&&0===str.toString().trim().length?!0:!1},areEmptyStrings:function(){return internal.reiterativeValidation(external.isEmptyString,external.argumentsToArray(arguments))},hasWildCard:function(str){return-1!==str.indexOf("*")}}}),msngr.extend(function(external,internal){"use strict";return internal.objects=internal.objects||{},internal.objects.executer=function(methods,payload,context){if(external.isFunction(methods)&&(methods=[methods]),!external.exist(methods)||!external.isArray(methods))throw internal.InvalidParametersException("executor");var exec=function(method,pay,ctx,done){setTimeout(function(){var async=!1,asyncFunc=function(){return async=!0,function(result){done.apply(ctx,[result])}},params=void 0;params=external.isArray(pay)?pay:[pay],params.push(asyncFunc);var syncResult=method.apply(ctx||this,params);async!==!0&&done.apply(ctx,[syncResult])},0)};return{execute:function(done){return 0===methods.length&&external.exist(done)?done.apply(context,[[]]):exec(methods[0],payload,context,done)},parallel:function(done){var results=[],executed=0;if(0===methods.length&&external.exist(done))return done.apply(context,[[]]);for(var i=0;i<methods.length;++i)!function(m,p,c){exec(m,p,c,function(result){external.exist(result)&&results.push(result),++executed,executed===methods.length&&external.exist(done)&&done.apply(context,[results])})}(methods[i],payload,context)}}},{executer:internal.objects.executer}}),msngr.extend(function(external,internal){"use strict";return internal.objects=internal.objects||{},internal.objects.memory=function(){var id_to_message={},index={},index_count=0,mem={index:function(message){if(external.exist(message)&&external.exist(message.topic)){var uuid=external.id();return id_to_message[uuid]=message,external.exist(index[message.topic])||(index[message.topic]={uuids:[],category:{}}),external.exist(index[message.topic].category[message.category])||(index[message.topic].category[message.category]={uuids:[],subcategory:{}}),external.exist(index[message.topic].category[message.category].subcategory[message.subcategory])||(index[message.topic].category[message.category].subcategory[message.subcategory]={uuids:[]}),external.exist(message.category)||external.exist(message.subcategory)||index[message.topic].uuids.push(uuid),external.exist(message.category)&&!external.exist(message.subcategory)&&index[message.topic].category[message.category].uuids.push(uuid),external.exist(message.category)&&external.exist(message.subcategory)&&index[message.topic].category[message.category].subcategory[message.subcategory].uuids.push(uuid),index_count++,uuid}return void 0},"delete":function(uuid){if(external.exist(uuid)&&external.exist(id_to_message[uuid])){var message=id_to_message[uuid];return external.removeFromArray(index[message.topic].uuids,uuid),external.removeFromArray(index[message.topic].category[message.category].uuids,uuid),external.removeFromArray(index[message.topic].category[message.category].subcategory[message.subcategory].uuids,uuid),delete id_to_message[uuid],index_count--,!0}return!1},query:function(message){var result=[];if(external.exist(message)&&external.exist(message.topic)&&external.exist(index[message.topic])){var indexTopic=index[message.topic],indexTopicCategory=((indexTopic||{}).category||{})[message.category],indexTopicCategorySubcategory=((indexTopicCategory||{}).subcategory||{})[message.subcategory];result=result.concat(indexTopic.uuids||[]),result=result.concat((indexTopicCategory||{}).uuids||[]),result=result.concat((indexTopicCategorySubcategory||{}).uuids||[])}return external.deDupeArray(result)},clear:function(){return id_to_message={},index={},index_count=0,!0}};return Object.defineProperty(mem,"count",{get:function(){return index_count}}),mem},{}}),msngr.extend(function(external,internal){"use strict";internal.objects=internal.objects||{};var messageIndex=internal.objects.memory(),payloadIndex=internal.objects.memory(),handlers={},handlerCount=0,payloads={},payloadCount=0,boundDOMPaths={},boundCount=0;return Object.defineProperty(internal,"handlerCount",{get:function(){return handlerCount}}),Object.defineProperty(internal,"boundCount",{get:function(){return boundCount}}),Object.defineProperty(internal,"payloadCount",{get:function(){return payloadCount}}),internal.reset=function(){handlers={},boundDOMPaths={},handlerCount=0,boundCount=0,messageIndex.clear(),payloadIndex.clear(),payloads={},payloadCount=0},internal.processOpts=function(opts,message,payload,callback){var optProcessors=[];for(var key in opts)opts.hasOwnProperty(key)&&external.exist(internal.options[key])&&optProcessors.push(internal.options[key]);if(0===optProcessors.length)return callback.apply(this,[payload]);var execs=internal.objects.executer(optProcessors,[message,payload,opts],this);execs.parallel(function(results){var result=payload;if(external.exist(results)&&results.length>0)for(var i=0;i<results.length;++i)external.exist(results[i])&&(result=external.merge(results[i],result));callback.apply(this,[result])})},internal.domListener=function(event){var node=this,path=external.getDomPath(node);return external.exist(boundDOMPaths[path])&&external.exist(boundDOMPaths[path][event.type])?boundDOMPaths[path][event.type].emit():void 0},internal.objects.message=function(topic,category,subcategory){var msg=void 0;if(!external.exist(topic))throw internal.InvalidParametersException("msngr");if(!external.isObject(topic)&&!external.isString(topic))throw internal.InvalidParametersException("msngr");if(external.isEmptyString(topic))throw internal.InvalidParametersException("msngr");external.isObject(topic)?msg=topic:(msg={},msg.topic=topic,external.isEmptyString(category)||(msg.category=category),external.isEmptyString(subcategory)||(msg.subcategory=subcategory));var options=external.merge({},internal.globalOptions),counts={emits:0,persists:0,options:0,ons:0,onces:0,binds:0},explicitEmit=function(payload,uuids,callback){for(var uuids=uuids||messageIndex.query(msg)||[],methods=[],toDrop=[],i=0;i<uuids.length;++i){var obj=handlers[uuids[i]];methods.push(obj.handler),obj.once===!0&&toDrop.push(obj.handler)}internal.processOpts(options,msg,payload,function(result){for(var execs=internal.objects.executer(methods,result,msg.context||this),i=0;i<toDrop.length;++i)msgObj.drop(toDrop[i]);execs.parallel(callback)})},fetchPersisted=function(){var fpay,uuids=payloadIndex.query(msg);if(0===uuids.length)return void 0;if(1===uuids.length)return payloads[uuids[0]];for(var i=0;i<uuids.length;++i)fpay=external.extend(innerPay,fpay);return fpay},msgObj={option:function(key,value){if(!external.exist(key)||!external.isString(key))throw internal.InvalidParametersException("option");return options[key]=value,counts.options=counts.options+1,msgObj},emit:function(payload,callback){return external.isFunction(payload)&&(callback=payload,payload=void 0),explicitEmit(payload,void 0,callback),counts.emits=counts.emits+1,msgObj},persist:function(payload){void 0===payload&&(payload=null);var uuids=payloadIndex.query(msg);if(0===uuids.length){var uuid=payloadIndex.index(msg);payloads[uuid]=payload,uuids=[uuid]}else for(var i=0;i<uuids.length;++i)payloads[uuids[i]]=external.extend(payload,payloads[uuids[i]]);var fpay=fetchPersisted();return++payloadCount,counts.persists=counts.persists+1,msgObj.emit(fpay)},cease:function(){for(var uuids=payloadIndex.query(msg),i=0;i<uuids.length;++i)delete payloads[uuids[i]],--payloadCount;return msgObj},on:function(handler){var uuid=messageIndex.index(msg);handlers[uuid]={handler:handler,context:msg.context||this,once:!1},handlerCount++;var payload=fetchPersisted();return void 0!==payload&&explicitEmit(payload,[uuid],void 0),counts.ons=counts.ons+1,msgObj},once:function(handler){var uuid=messageIndex.index(msg);handlers[uuid]={handler:handler,context:msg.context||this,once:!0},handlerCount++;var payload=fetchPersisted();return void 0!==payload&&explicitEmit(payload,[uuid],void 0),counts.onces=counts.onces+1,msgObj},bind:function(element,event){var node=external.findElement(element),path=external.getDomPath(node);return external.exist(boundDOMPaths[path])||(boundDOMPaths[path]={}),boundDOMPaths[path][event]=msgObj,node.addEventListener(event,internal.domListener),++boundCount,counts.binds=counts.binds+1,msgObj},drop:function(handler){var uuids=messageIndex.query(msg);if(uuids.length>0)for(var i=0;i<uuids.length;++i){var uuid=uuids[i];handlers[uuid].handler===handler&&(delete handlers[uuid],handlerCount--,messageIndex["delete"](uuid))}return msgObj},unbind:function(element,event){var node=external.findElement(element),path=external.getDomPath(node);return external.exist(boundDOMPaths[path])&&external.exist(boundDOMPaths[path][event])&&(node.removeEventListener(event,internal.domListener),delete boundDOMPaths[path][event],--boundCount),msgObj},dropAll:function(){var uuids=messageIndex.query(msg);if(uuids.length>0)for(var i=uuids.length;i--;){var uuid=uuids[i];delete handlers[uuid],handlerCount--,messageIndex["delete"](uuid)}return msgObj}};return Object.defineProperty(msgObj,"message",{get:function(){return msg}}),Object.defineProperty(msgObj,"subscribers",{get:function(){return messageIndex.query(msg).length}}),external.debug===!0&&Object.defineProperty(msgObj,"counts",{get:function(){return counts}}),msgObj},{}}),msngr.extend(function(external,internal){"use strict";var CHANNEL_NAME="__msngr_cross-window";return internal.options=internal.options||{},"undefined"==typeof localStorage||"undefined"==typeof window?{}:(window.addEventListener("storage",function(event){if(event.key===CHANNEL_NAME){var obj;try{obj=JSON.parse(event.newValue)}catch(ex){throw"msngr was unable to parse the data in its storage channel"}void 0!==obj&&external.isObject(obj)&&internal.objects.message(obj.message).emit(obj.payload)}}),internal.options["cross-window"]=function(message,payload,options,async){options=options||{},options=options["cross-window"]||{};var obj={message:message,payload:payload};try{localStorage.setItem(CHANNEL_NAME,JSON.stringify(obj))}catch(ex){throw"msngr was unable to store data in its storage channel"}return void 0},{})}),msngr.extend(function(external,internal){"use strict";return internal.options=internal.options||{},internal.options.dom=function(message,payload,options,async){options=options||{},options=options.dom||{};var doc=options.doc||options.document||document,selectors=void 0;if(external.isObject(options)&&external.exist(options.selectors)&&external.isString(options.selectors)?selectors=[options.selectors]:external.isString(options)?selectors=[options]:external.isArray(options)&&(selectors=options),!external.exist(doc)||!external.exist(selectors)||0===selectors.length)return void 0;for(var elements=[],selLength=selectors.length,i=0;selLength>i;++i){var found=external.findElements(selectors[i],doc);found.length>0&&(elements=elements.concat(Array.prototype.slice.call(found)))}if(0===elements.length)return void 0;for(var resultMap=void 0,elmLength=elements.length,unnamedTags=0,i=0;elmLength>i;++i){var key=void 0,elm=elements[i],nameAttr=elm.getAttribute("name"),idAttr=elm.id,tagName=elm.tagName.toLowerCase(),val=elm.value;external.exist(nameAttr)&&!external.isEmptyString(nameAttr)?key=nameAttr:external.exist(idAttr)&&!external.isEmptyString(idAttr)?key=idAttr:(key=tagName+unnamedTags,unnamedTags++),void 0===resultMap&&(resultMap={}),resultMap[key]=val}return resultMap},{}}),"undefined"!=typeof module&&"undefined"!=typeof module.exports&&(module.exports=msngr);