var msngr=msngr||function(){return{version:"0.3.0",extend:function(obj,target){if(target=target||msngr,"[object Object]"===Object.prototype.toString.call(obj))for(var key in obj)obj.hasOwnProperty(key)&&("[object Object]"===Object.prototype.toString.call(obj[key])?(void 0===target[key]&&(target[key]={}),target[key]=msngr.extend(obj[key],target[key])):target[key]="[object Array]"===Object.prototype.toString.call(obj[key])?(target[key]||[]).concat(obj[key]):obj[key]);return target}}}();msngr.extend(function(){return{utils:{argumentsToArray:function(args){return Array.prototype.slice.call(args,0)}}}}()),msngr.extend(function(){return{utils:{ensureMessage:function(message){return msngr.utils.isNullOrUndefined(message)?void 0:msngr.utils.isString(message)&&!msngr.utils.isEmptyString(message)?{topic:message}:message}}}}()),msngr.extend(function(){return{utils:{ThrowNotImplementedException:function(){throw"Method is not implemented"},ThrowRequiredParameterMissingOrUndefinedException:function(params){throw msngr.utils.isArray(params)?params.join(",")+" are required parameters and must not be missing or undefined":params+" is a required parameter and must not be missing or undefined"},ThrowMismatchedInterfaceException:function(interface){throw"The implementation does not match the "+(interface||"unknown")+" interface"},ThrowInvalidMessage:function(){throw"The message is not valid"},ThrowEventNotFoundException:function(){throw"The event is not found to be unregistered"},ThrowForeignKeyNotUniqueException:function(){throw"The provided foreign key is not unique"}}}}()),msngr.extend(function(){var deprecatedMessages=[],index={fk_message:{},exact:{topic:{},category:{},dataType:{}}},indexField=function(field,message,fk){return msngr.utils.isNullOrUndefined(field)||msngr.utils.isEmptyString(field)?!1:msngr.utils.doesFieldContainWildcard(field,message)?!1:(void 0===index.exact[field][message[field]]&&(index.exact[field][message[field]]={}),index.exact[field][message[field]][fk]=0,!0)},queryField=function(field,message){if(void 0===message[field]||void 0===message[field])return void 0;var result={};if(msngr.utils.doesFieldContainWildcard(field,message)){var start=msngr.utils.isNullOrUndefined(message[field])?void 0:message[field].substring(0,message[field].indexOf("*"));msngr.utils.isEmptyString(start)&&(start=void 0);for(var key in index.exact[field])if(index.exact[field].hasOwnProperty(key))if(void 0===start&&void 0!==index.exact[field][key])for(var fk in index.exact[field][key])index.exact[field][key].hasOwnProperty(fk)&&(result[fk]=0);else if(void 0!==index.exact[field][key]&&0===key.indexOf(start))for(var fk in index.exact[field][key])index.exact[field][key].hasOwnProperty(fk)&&(result[fk]=0);return result}return result=index.exact[field][message[field]]},deIndexField=function(field,message,fk){var count=0;for(var key in index.exact[field][message[field]])index.exact[field][message[field]].hasOwnProperty(key)&&count++;return 1===count?(delete index.exact[field][message[field]],!0):(delete index.exact[field][message[field]][fk],!0)};return{utils:{indexer:{index:function(message,fk){void 0!==index.fk_message[fk]&&msngr.utils.ThrowForeignKeyNotUniqueException(),message=msngr.utils.ensureMessage(message),index.fk_message[fk]=message,indexField("topic",message,fk),msngr.utils.isNullOrUndefined(message.category)||indexField("category",message,fk),msngr.utils.isNullOrUndefined(message.dataType)||indexField("dataType",message,fk)},query:function(message){message=msngr.utils.ensureMessage(message);var topics=queryField("topic",message),categories=queryField("category",message),dataTypes=queryField("dataType",message),result={count:0,items:{}};for(var fk in topics)if(topics.hasOwnProperty(fk))if(void 0===message.category&&void 0===message.dataType)result.items[fk]=0,result.count=result.count+1;else{var cats={};void 0!==categories&&void 0!==categories[fk]&&(cats[fk]=0);var datas={};void 0!==dataTypes&&void 0!==dataTypes[fk]&&(datas[fk]=0),void 0!==categories&&void 0!==dataTypes&&categories[fk]===dataTypes[fk]&&(result.items[fk]=0,result.count=result.count+1),void 0===message.category&&void 0===categories&&void 0!==dataTypes&&void 0!==dataTypes[fk]&&(result.items[fk]=0,result.count=result.count+1),void 0!==categories&&void 0===message.dataType&&void 0===dataTypes&&void 0!==categories[fk]&&(result.items[fk]=0,result.count=result.count+1)}return result},remove:function(fk){if(void 0!==index.fk_message[fk]){var message=index.fk_message[fk];deIndexField("topic",message,fk),msngr.utils.isNullOrUndefined(message.category)||deIndexField("category",message,fk),msngr.utils.isNullOrUndefined(message.dataType)||deIndexField("dataType",message,fk),delete index.fk_message[fk]}}},deprecatedIndexer:{index:function(message,fk){deprecatedMessages.push({message:message,key:fk})},query:function(message){for(var result=[],i=0;i<deprecatedMessages.length;++i)msngr.utils.isMessageMatch(message,deprecatedMessages[i].message)&&result.push(deprecatedMessages[i].key);return result},remove:function(fk){for(var i=0;i<deprecatedMessages.length;++i)if(deprecatedMessages[i].key===fk){var last=deprecatedMessages[deprecatedMessages.length-1];deprecatedMessages[deprecatedMessages.length-1]=deprecatedMessages[i],deprecatedMessages[i]=last,deprecatedMessages.pop()}}}}}}()),msngr.extend(function(){var idsUsed={};return{utils:{arrayContains:function(arr,values){if(msngr.utils.isNullOrUndefined(arr))return!1;msngr.utils.isArray(values)||(values=[values]);for(var i=0;i<values.length;++i)if(-1===arr.indexOf(values[i]))return!1;return!0},id:function(){var ms=Date.now(),rand=Math.floor(1e4*(Math.random()+1)),i=ms+"-"+rand;return void 0!==idsUsed[i]?msngr.utils.id():(idsUsed[i]=0,i)}}}}()),msngr.extend(function(){return{utils:{getType:function(obj){return Object.prototype.toString.call(obj)},isNullOrUndefined:function(obj){return void 0===obj||null===obj},isHtmlElement:function(obj){var t=this.getType(obj);return 0===t.indexOf("[object HTML")||0===t.indexOf("[object global]")},isNodeList:function(obj){return"[object NodeList]"===this.getType(obj)},isString:function(str){return"[object String]"===this.getType(str)},isDate:function(obj){return"[object Date]"===this.getType(obj)},isArray:function(obj){return"[object Array]"===this.getType(obj)},isNumber:function(obj){return"[object Number]"===this.getType(obj)},isObject:function(obj){return"[object Object]"===this.getType(obj)},isFunction:function(func){return"[object Function]"===this.getType(func)},isEmptyString:function(str){var isStr=this.isString(str);return void 0===str||null===str||isStr&&0===str.toString().length?!0:!1},isWildCardStringMatch:function(str1,str2){if(!this.isNullOrUndefined(str1)&&!this.isString(str1))return!1;if(!this.isNullOrUndefined(str2)&&!this.isString(str2))return!1;var str1EmptyResult,str2EmptyResult,str1Star=-1,str2Star=-1,shorterIndex=-1;return str1EmptyResult=this.isEmptyString(str1),str2EmptyResult=this.isEmptyString(str2),str1EmptyResult===!0||str2EmptyResult===!0?!0:str1.toLowerCase()===str2.toLowerCase()?!0:(str1Star=str1.indexOf("*"),str2Star=str2.indexOf("*"),shorterIndex=shorterIndex=shorterIndex=-1===str1Star||-1===str2Star?Math.max(str1Star,str2Star):Math.min(str1Star,str2Star),-1===str1Star&&-1===str2Star||-1===shorterIndex||str1.substring(0,shorterIndex).toLowerCase()!==str2.substring(0,shorterIndex).toLowerCase()?!1:!0)},isValidMessage:function(message){return this.isNullOrUndefined(message)?!1:this.isString(message)&&!this.isEmptyString(message)?!0:this.isNullOrUndefined(message.topic)||!this.isString(message.topic)||this.isEmptyString(message.topic)?!1:(this.isNullOrUndefined(message.category)||this.isString(message.category))&&(this.isNullOrUndefined(message.dataType)||this.isString(message.dataType))?!0:!1},isMessageMatch:function(sent,target){return this.isWildCardStringMatch(sent.topic,target.topic)&&this.isWildCardStringMatch(sent.category,target.category)&&this.isWildCardStringMatch(sent.dataType,target.dataType)?!0:!1},doesMessageContainWildcard:function(message){return message=this.ensureMessage(message),!this.isValidMessage(message)||-1===(message.topic||"").indexOf("*")&&-1===(message.category||"").indexOf("*")&&-1===(message.dataType||"").indexOf("*")?!1:!0},doesFieldContainWildcard:function(field,message){return message=this.ensureMessage(message),this.isValidMessage(message)?-1!==(message[field]||"").indexOf("*"):void 0},doesStringContainWildcard:function(str){return this.isString(str)?-1!==(str||"").indexOf("*"):!1},getPropertiesWithWildcards:function(message){var results=[];return-1!==(message.topic||"").indexOf("*")&&results.push("topic"),-1!==(message.category||"").indexOf("*")&&results.push("category"),-1!==(message.dataType||"").indexOf("*")&&results.push("dataType"),results},fieldShouldMatchAny:function(str){return this.doesStringContainWildcard(str)||this.isEmptyString(str)||this.isNullOrUndefined(str)}}}}()),msngr.extend(function(){var registered={routers:[],binders:[]},add=function(item,type){void 0===item&&msngr.utils.ThrowRequiredParameterMissingOrUndefinedException("item"),registered[type].push(item)},get=function(index,type){return void 0===index&&msngr.utils.ThrowRequiredParameterMissingOrUndefinedException("index"),registered[type][index]},count=function(type){return registered[type].length},remove=function(index,type){void 0===index&&msngr.utils.ThrowRequiredParameterMissingOrUndefinedException("index");var endIndex=registered[type].length-1;if(index!==endIndex){var temp=registered[type][endIndex];registered[type][endIndex]=registered[type][index],registered[type][index]=temp}return registered[type].pop(),this};return{registry:{routers:{add:function(router){return add(router,"routers")},get:function(index){return get(index,"routers")},count:function(){return count("routers")},remove:function(index){return remove(index,"routers")}},binders:{add:function(binder){return add(binder,"binders")},get:function(index){return get(index,"binders")},count:function(){return count("binders")},remove:function(index){return remove(index,"binders")}}}}}()),msngr.registry.routers.add(function(){var receivers={},receiverCount=0,executeReceiverSync=function(method,context,params){method.apply(context,params)},executeReceiver=function(method,context,params){!function(m,c,p){setTimeout(function(){executeReceiverSync(m,c,p)},0)}(method,context,params)},handleEmit=function(message){msngr.utils.isValidMessage(message)||msngr.utils.ThrowRequiredParameterMissingOrUndefinedException("message");var keys=msngr.utils.indexer.query(message);if(keys.count>0)for(var key in keys.items)keys.items.hasOwnProperty(key)&&executeReceiver(receivers[key].callback,receivers[key].context,[message.payload])},handleReceiverRegistration=function(message,callback,context){var id=msngr.utils.id();return receivers[id]={message:message,callback:callback,context:context,fk:id},msngr.utils.indexer.index(message,id),receiverCount++,id},handleReceiverRemoval=function(fk){msngr.utils.indexer.remove(fk),delete receivers[fk]};return{domain:"local",emit:function(message){return msngr.utils.isValidMessage(message)||msngr.utils.ThrowRequiredParameterMissingOrUndefinedException("message"),handleEmit(message)},register:function(message,callback,context){return msngr.utils.isValidMessage(message)||msngr.utils.ThrowRequiredParameterMissingOrUndefinedException("message"),handleReceiverRegistration(message,callback,context||this)},unregister:function(receiver){return msngr.utils.isNullOrUndefined(receiver)&&msngr.utils.ThrowRequiredParameterMissingOrUndefinedException("receiver"),handleReceiverRemoval(receiver)}}}()),msngr.registry.binders.add(function(){var listeners={},eventListeners={passThrough:function(e,message){msngr.emit({topic:message.topic,category:message.category,dataType:message.dataType,payload:e})}},findElement=function(element){var elm;if(void 0===elm&&msngr.utils.isHtmlElement(element)&&(elm=element),void 0===elm&&msngr.utils.isString(element)){var result=document.getElementById(element);result=null!==result?result:document.querySelector(element),null!==result&&(elm=result)}return elm},getListener=function(evnt,message,context){var func=function(e){void 0!==eventListeners[evnt]?eventListeners[evnt].apply(context,[e,message]):eventListeners.passThrough.apply(context,[e,message])};return func};return{domain:"dom",bind:function(element,evnt,message){msngr.utils.isNullOrUndefined(element)&&msngr.utils.ThrowRequiredParameterMissingOrUndefinedException("element"),msngr.utils.isNullOrUndefined(evnt)&&msngr.utils.ThrowRequiredParameterMissingOrUndefinedException("event"),msngr.utils.isNullOrUndefined(message)&&msngr.utils.ThrowRequiredParameterMissingOrUndefinedException("message"),msngr.utils.isValidMessage(message)||msngr.utils.ThrowInvalidMessage(),message=msngr.utils.ensureMessage(message);var elm=findElement(element);void 0===elm&&msngr.utils.ThrowRequiredParameterMissingOrUndefinedException("element"),void 0===listeners[elm]&&(listeners[elm]={}),void 0===listeners[elm][evnt]&&(listeners[elm][evnt]={}),void 0===listeners[elm][evnt][message]&&(listeners[elm][evnt][message]=[]);var listener=getListener(evnt,message,this);return listeners[elm][evnt][message].push(getListener(message,this)),elm.addEventListener(evnt,listener,!1),this},unbind:function(element,evnt,message){msngr.utils.isNullOrUndefined(element)&&msngr.utils.ThrowRequiredParameterMissingOrUndefinedException("element"),msngr.utils.isNullOrUndefined(evnt)&&msngr.utils.ThrowRequiredParameterMissingOrUndefinedException("event"),msngr.utils.isNullOrUndefined(message)&&msngr.utils.ThrowRequiredParameterMissingOrUndefinedException("message"),msngr.utils.isValidMessage(message)||msngr.utils.ThrowInvalidMessage(),message=msngr.utils.ensureMessage(message);var elm=findElement(element);void 0===elm&&msngr.utils.ThrowRequiredParameterMissingOrUndefinedException("element"),(void 0===listeners[elm]||void 0===listeners[elm][evnt]||void 0===listeners[elm][evnt][message]||0===listeners[elm][evnt][message].length)&&msngr.utils.ThrowEventNotFoundException();for(var i=0;i<listeners[elm][evnt][message].length;++i)elm.removeEventListener(evnt,listeners[elm][evnt][message],!1);listeners[elm][evnt][message]=[]}}}()),msngr.extend(function(){return{bind:function(element,event,message){msngr.utils.isValidMessage(message)||msngr.utils.ThrowRequiredParameterMissingOrUndefinedException("message");var msg=msngr.utils.ensureMessage(message);msg.domain=msg.domain||"local";for(var i=0;i<msngr.registry.binders.count();++i)msngr.registry.binders.get(i).bind(element,event,msg)}}}()),msngr.extend(function(){return{emit:function(message,context){msngr.utils.isValidMessage(message)||msngr.utils.ThrowRequiredParameterMissingOrUndefinedException("message");for(var msg=msngr.utils.ensureMessage(message),i=0;i<msngr.registry.routers.count();++i){var router=msngr.registry.routers.get(i);msngr.utils.isNullOrUndefined(msg.domain)&&(msg.domain="local"),(msg.domain===router.domain||"localAndRemote"===msg.domain)&&router.emit(msg,context)}}}}()),msngr.extend(function(){return{register:function(message,callback,context){msngr.utils.isValidMessage(message)||msngr.utils.ThrowRequiredParameterMissingOrUndefinedException("message");for(var result=[],i=0;i<msngr.registry.routers.count();++i)result.push(msngr.registry.routers.get(i).register(msngr.utils.ensureMessage(message),callback,context));return 1===result.length?result[0]:result}}}()),msngr.extend(function(){return{unbind:function(element,event,message){msngr.utils.isValidMessage(message)||msngr.utils.ThrowRequiredParameterMissingOrUndefinedException("message");for(var i=0;i<msngr.registry.binders.count();++i)msngr.registry.binders.get(i).unbind(element,event,msngr.utils.ensureMessage(message))}}}()),msngr.extend(function(){return{unregister:function(id){msngr.utils.isNullOrUndefined(id)&&msngr.utils.ThrowRequiredParameterMissingOrUndefinedException("id");for(var result=[],i=0;i<msngr.registry.routers.count();++i)result.push(msngr.registry.routers.get(i).unregister(id));return 1===result.length?result[0]:result}}}()),"undefined"!=typeof module&&"undefined"!=typeof module.exports&&(module.exports=msngr);